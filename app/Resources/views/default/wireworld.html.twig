{% extends 'board.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="css/wireworld.css" rel="stylesheet"/>

    <style>
        #board span {
            width: 4px;
            height: 4px;
            border: none !important
        }

        ;
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="js/wireworld.js"></script>
    <script src="js/wireworld-digit-board.js"></script>
    <script src="js/wireworld-digit-alt-board.js"></script>
    <script>
        var speed = 100;
        var app = null;
        var board = null;

        var height = 34 * 2;
        var width = 64 * 2;

        var pattern = location.href.replace(/^.*?(\d+).*?$/, '$1');
        pattern = isNaN(pattern) ? 0 : parseInt(pattern);
        var digit = 0;

        if (pattern === 3) {
            var temp = location.href.replace(/^.*?\?(.*)$/, '$1').split(',');
            if (temp.length > 1) {
                digit = isNaN(temp[1]) ? 0 : parseInt(temp[1]);
            }

            width = wireworldDigitBoard[0].length;
            height = wireworldDigitBoard.length;
            wireworldDigitBoard[272][37 + digit * 6] = 1;
            wireworldDigitBoard[273][37 + digit * 6] = 3;
            wireworldDigitBoard[273][37 + digit * 6 + 1] = 2;
        }

        if (pattern === 4) {
            temp = location.href.replace(/^.*?\?(.*)$/, '$1').split(',');
            if (temp.length > 1) {
                digit = isNaN(temp[1]) ? 0 : parseInt(temp[1]);
            }

            width = wireworldDigitAltBoard[0].length;
            height = wireworldDigitAltBoard.length;

            wireworldDigitAltBoard[179][48] = 2;
            wireworldDigitAltBoard[178][48] = 1;

            wireworldDigitAltBoard[185][48] = 2;
            wireworldDigitAltBoard[186][48] = 1;

        }


        $(document).ready(function () {

            board = new Board(height, width);

            if (pattern === 3) {
                width = 128;
                height = 280;
            }

            app = new Wireworld(board, pattern);

            if (pattern === 4) {
                app.trigger = function (condition) {
                    var to = 10;
                    if (condition) {
                        for (var i = 0; i < to; i++) {
                            var offset = i * 6;

                            var cond = i < digit;

                            if (!cond) {
                                this.grid[204][offset + 64] = 1;
                                this.grid[204][offset + 64 + 1] = 2;
                            }

                            if (cond) {
                                this.grid[202][offset + 64 - 1] = 1;
                                this.grid[202][offset + 64 - 1 + 1] = 2;
                            }
                        }
                    }
                };
            }

            run(app, speed);
        });
    </script>
{% endblock %}
